"use strict";const firebaseConfig={apiKey:"AIzaSyBfDaWdN16xnSvh945d7alHWc_d1dW7lMU",authDomain:"task-panel-723b2.firebaseapp.com",databaseURL:"https://task-panel-723b2.firebaseio.com",projectId:"task-panel-723b2",storageBucket:"task-panel-723b2.appspot.com",messagingSenderId:"70176189679",appId:"1:70176189679:web:31307d78853bad54",measurementId:"G-J6FSYY1PMT"},myUserId="wX4nfMMn6VhPjfzMYWoXPwssvDY2";firebase.initializeApp(firebaseConfig);const db=firebase.firestore(),quoteText=document.getElementById("quote-text"),quoteAuthor=document.getElementById("quote-author"),langRuButton=document.getElementById("langRu"),langEnButton=document.getElementById("langEn"),StoicQuoteButton=document.getElementById("StoicQuote"),regularContainer=document.getElementById("regular"),notFoundContainer=document.getElementById("notFound"),loaderContainer=document.getElementById("loader"),PREFIX="wirtaw.githab.io",quoteKey=e=>`${PREFIX}-clientQuote-${e}`,stoicQuoteKey=e=>`${PREFIX}-clientStoicQuote-${e}`,languageKey=`${PREFIX}-clientQuote-language`,randomInt=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;function leftPad(e){return["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"][e]}function manageLanguageButtons(e){langRuButton.disabled="ru"===e,langEnButton.disabled="en"===e,StoicQuoteButton.disabled=!1}function saveQuote(e,t){const o={data:e,expires:Date.now()+864e5};localStorage.setItem(quoteKey(t),JSON.stringify(o))}function saveStoicQuote(e,t){const o=new Date,n=leftPad(o.getMonth()+1),a=leftPad(o.getDate()),l={data:e,expires:new Date(`${o.getFullYear()}-${n}-${a}T23:59:59`).getTime()};localStorage.setItem(stoicQuoteKey(t),JSON.stringify(l))}async function getStoicQuoteByLang(e){return new Promise((t=>{if(db||t(null),localStorage.getItem(stoicQuoteKey(e))){const o=localStorage.getItem(stoicQuoteKey(e)),{expires:n,...a}=JSON.parse(o);t({...a.data})}const o=new Date,n=leftPad(o.getMonth()+1),a=leftPad(o.getDate());db.collection("users").doc(myUserId).collection("quotes").where("type","==","stoic").where("language","==",e).where("date","==",`${o.getFullYear()}-${n}-${a}`).get().then((o=>{o.forEach((o=>{const n=o.data();saveStoicQuote(n,e),t(n)}))}))}))}async function getQuotesByLang(e){return new Promise((t=>{db||t([]);const o=[];db.collection("users").doc(myUserId).collection("quotes").where("type","!=","stoic").where("language","==",e).limit(20).get().then((e=>{e.forEach((e=>{const t=e.data();o.push(t)})),t(o)}))}))}async function getRandomQuote(e){const t=(await getQuotesByLang(e)).filter((({language:t})=>t===e));return t.length?t[randomInt(0,t.length-1)]:null}async function displayQuote(e=null){if(!localStorage.getItem("cookieConsent")){const e=document.createElement("div");e.innerHTML='\n      <p class="cookie-consent">We use cookies to enhance your experience. By continuing to visit this site you agree to our use of cookies.</p>\n      <button class="button" id="acceptCookies">Accept</button>\n      ',e.style.position="fixed",e.style.bottom="0",e.style.left="0",e.style.right="0",e.style.padding="20px",e.style.backgroundColor="#fff",e.style.border="solid 1px #485fc7",e.style.color="#000",e.style.textAlign="center",e.style.zIndex="1000",document.body.appendChild(e),document.getElementById("acceptCookies").addEventListener("click",(function(){localStorage.setItem("cookieConsent","true"),document.body.removeChild(e)}))}const t=["en","ru","pl"],o=navigator.languages[0].split("-")[0];let n=e||localStorage.getItem(languageKey);!n&&o?(n=t.includes(o)?o:"en",localStorage.setItem(languageKey,n)):e&&localStorage.setItem(languageKey,n);let a,l=null,u=null;if(localStorage.getItem(quoteKey(n))){u=localStorage.getItem(quoteKey(n));const{expires:e,...t}=JSON.parse(u);l=e,a={...t}}(!a||Date.now()>l)&&(a=await getRandomQuote(n),a&&saveQuote(a,n)),a?(manageLanguageButtons(n),quoteText.textContent=a.quote||a.data.quote,quoteAuthor.textContent=a?.author?`- ${a.author}`:`- ${a.data.author}`,loaderContainer.style.display="none",regularContainer.style.display="block",notFoundContainer.style.display="none"):(quoteText.textContent="",quoteAuthor.textContent="",loaderContainer.style.display="none",regularContainer.style.display="none",notFoundContainer.style.display="block")}async function displayStoicQuote(){let e=navigator.languages[0].split("-")[0]||"en",t=await getStoicQuoteByLang(e);t?(regularContainer.style.display="block",notFoundContainer.style.display="none",loaderContainer.style.display="none",quoteText.textContent=t.quote,quoteAuthor.textContent=`- ${t.author}`):(localStorage.setItem(languageKey,"en"),t=await getStoicQuoteByLang("en"),t?(regularContainer.style.display="block",notFoundContainer.style.display="none",loaderContainer.style.display="none",quoteText.textContent=t.quote,quoteAuthor.textContent=`- ${t.author}`):(quoteText.textContent="",quoteAuthor.textContent="",regularContainer.style.display="none",notFoundContainer.style.display="block",loaderContainer.style.display="none"))}document.addEventListener("DOMContentLoaded",displayQuote(null)),langEnButton.addEventListener("click",(()=>displayQuote("en"))),langRuButton.addEventListener("click",(()=>displayQuote("ru"))),StoicQuoteButton.addEventListener("click",(()=>displayStoicQuote()));